<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Plan</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <button class="btn btn-primary" id="prevButton">Previous</button>
        <h2 id="dateTitle">Meal Plan for: 2023-12-11</h2>
        <button class="btn btn-primary" id="nextButton">Next</button>
    </div>
    <div class="row" id="mealPlanCards">
        <!-- Food cards will be dynamically populated here -->
    </div>
</div>

<script>
    let mealPlans = [];
    // Example meal plan data (in real implementation, pass this data via Thymeleaf)
    async function getMealPlanHistory() {
        try {
            // Replace with your actual API endpoint
            const response = await fetch('/food/getAllMealPlan');
            if (!response.ok) {
                throw new Error('Failed to fetch food data');
            }

            // Parse JSON data
            mealPlans = await response.json();
            updateMealPlanDisplay();
        }  catch (error) {
            console.error(error);
        }
    }



    let currentIndex = 0;

    function updateMealPlanDisplay() {
        const mealPlan = mealPlans[currentIndex];
        const dateTitle = document.getElementById("dateTitle");
        const mealPlanCards = document.getElementById("mealPlanCards");
        console.log(mealPlans)

        dateTitle.textContent = `Meal Plan for: ${mealPlan.createdAt}`;
        mealPlanCards.innerHTML = `
            ${generateFoodCard(mealPlan.breakfast_main, 'Breakfast_Main')}
            ${generateFoodCard(mealPlan.breakfast_side, 'Breakfast_Side')}
            ${generateFoodCard(mealPlan.lunch_main, 'Lunch_Main')}
            ${generateFoodCard(mealPlan.lunch_side, 'Lunch_Side')}
            ${generateFoodCard(mealPlan.dinner_main, 'Dinner_Main')}
            ${generateFoodCard(mealPlan.dinner_side, 'Dinner_Side')}
        `;
    }

    function generateFoodCard(food, id) {
        return `
            <div class="col-md-6 mb-4">
                <div class="card food-card" id="${id.toLowerCase().replace(' ', '_')}_div">
                    <img src="${food.imageURL}" class="card-img-top" alt="${id} Image">
                    <div class="card-body">
                        <h5 class="card-title">${food.name}</h5>
                        <p class="card-text">Calories: ${food.calories}</p>
                        <p class="card-text">Recommended Meal Time: ${food.meal_time}</p>
                        <button class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#details_${id}">Details</button>
                        <div id="details_${id}" class="collapse mt-2">
                            <p>Category: ${food.category}</p>
                            <p>Ingredients: ${food.ingredients.join(', ')}</p>
                            <p>How to Cook: ${food.how_to_cook}</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    document.getElementById("prevButton").addEventListener("click", () => {
        if (currentIndex > 0) {
            currentIndex--;
            updateMealPlanDisplay();
        }
    });

    document.getElementById("nextButton").addEventListener("click", () => {
        if (currentIndex < mealPlans.length - 1) {
            currentIndex++;
            updateMealPlanDisplay();
        }
    });

    // Initial render
    document.addEventListener("DOMContentLoaded", getMealPlanHistory);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
